# Пошаговая настройка: от схем электропитания до виджета

Эта инструкция описывает полный путь: от установки кастомных режимов энергопотребления до запуска виджета Power Manager на рабочем столе.

---

## Шаг 0. Требования

- **Windows 10** или **Windows 11**
- **PowerShell** (встроен в Windows)
- **.NET 8.0**  
  - Для сборки из исходников: [.NET 8 SDK](https://dotnet.microsoft.com/download/dotnet/8.0)  
  - Для запуска только exe: .NET 8 Desktop Runtime (Windows)

---

## Шаг 1. Получить исходный код

Клонируйте репозиторий или распакуйте архив в папку, например `C:\power_manager`:

```powershell
git clone https://github.com/ai-art-agent/power_manager.git
cd power_manager
```

Либо скачайте ZIP с GitHub и откройте папку в PowerShell: `cd C:\path\to\power_manager`.

---

## Шаг 2. Просмотр текущих схем электропитания (опционально)

Проверить, какие схемы уже есть в системе:

```powershell
.\scripts\List-PowerSchemes.ps1
```

Вывод — список всех схем и активная схема (отмечена звёздочкой).

---

## Шаг 3. Создание трёх схем Power Manager

Запустите скрипт **от имени администратора** (рекомендуется):

1. Откройте PowerShell от имени администратора.
2. Перейдите в папку проекта:
   ```powershell
   cd C:\path\to\power_manager
   ```
3. Выполните:
   ```powershell
   .\scripts\Install-PowerManagerSchemes.ps1
   ```

Что делает скрипт:

- Удаляет предыдущие схемы Power Manager (если есть `scheme-guids.json`).
- Создаёт три новые схемы:
  - **Power Manager: Minimum** — CPU макс. 50%, энергосбережение, пассивное охлаждение.
  - **Power Manager: Balanced** — CPU макс. 90%, сбалансированные настройки.
  - **Power Manager: Maximum** — CPU 100%, активное охлаждение, без ограничений по питанию.
- Удаляет лишние системные схемы, оставляя только эти три и шаблон «Сбалансированная» (381b4222-…).
- Записывает GUID схем в файл **`scheme-guids.json`** в корне проекта.

После выполнения в корне должен появиться (или обновиться) файл **`scheme-guids.json`** с полями `Min`, `Balanced`, `Max`. Этот файл нужен виджету и скрипту переключения.

---

## Шаг 4. Переключение схем из консоли (опционально)

Без виджета схему можно менять скриптом:

```powershell
.\scripts\Apply-PowerScheme.ps1 -Scheme Min
.\scripts\Apply-PowerScheme.ps1 -Scheme Balanced
.\scripts\Apply-PowerScheme.ps1 -Scheme Max
```

Скрипт меняет **только** активную схему электропитания; яркость экрана не изменяется.

---

## Шаг 5. Запуск виджета

### Вариант A: из исходников (dotnet run)

Из корня проекта:

```powershell
dotnet run --project src\PowerManagerWidget\PowerManagerWidget.csproj
```

При первой сборке будут скачаны зависимости (LibreHardwareMonitor, NAudio и др.). Окно виджета появится на рабочем столе (обычно ближе к левому верхнему углу).

### Вариант B: сборка и запуск exe

```powershell
dotnet build src\PowerManagerWidget\PowerManagerWidget.csproj -c Release
.\src\PowerManagerWidget\bin\Release\net8.0-windows\PowerManagerWidget.exe
```

В папке с exe должен лежать **`scheme-guids.json`** — он копируется при сборке из корня проекта. Если вы запускаете exe из другого места, скопируйте туда `scheme-guids.json` из корня репозитория.

### Доступ к датчикам температуры

Для чтения температуры CPU приложение использует LibreHardwareMonitor. На части ПК для доступа к датчикам нужны права администратора. Если температура не отображается или показывается «-- °C», попробуйте запустить виджет **от имени администратора**.

---

## Шаг 6. Использование виджета

- **Три круглые кнопки** — переключение схемы (Минимум / Сбалансированная / Максимум).
- **Авто** — автоматический выбор схемы по нагрузке, температуре и батарее; интервалы обновления графиков и проверки авто задаются внизу панели.
- **Яркость / Звук** — ползунки (яркость через WMI, только встроенный экран).
- **Энергосбережение** — галочка включает/выключает системное энергосбережение (панель Win+A).
- **Защита глаз** — открывает параметры ночного режима Windows.
- **Поверх всех окон** — панель поверх остальных окон.
- **Кнопки − и ×** вверху справа — свернуть окно и выход (при выходе можно выбрать оставляемую схему).

Окно можно перетаскивать за любую область (кроме кнопок).

---

## Устранение неполадок

| Проблема | Что проверить |
|----------|----------------|
| Виджет не видит схемы | Убедитесь, что выполнен шаг 3 и рядом с exe есть `scheme-guids.json`. |
| Температура не показывается | Запустите виджет от имени администратора. |
| Яркость не меняется | Управление по WMI работает только для встроенной панели; внешние мониторы не поддерживаются. |
| Ошибка при запуске скрипта | Запустите PowerShell от имени администратора; проверьте, что путь к `scheme-guids.json` корректен (`scripts\..\scheme-guids.json`). |

Подробнее о параметрах схем и реестре: **[power-schemes.md](power-schemes.md)**  
Чек-лист проверки виджета: **[power-widget-test.md](power-widget-test.md)**
